# Antigravity Project Instructions

## このファイルの位置づけ
- この instructions.md は **このリポジトリにおける最優先のプロジェクト前提** です
- グローバルな GEMINI.md の思想・原則を前提として **具体的な実装判断を補足** します
- ユーザーの指示が曖昧な場合は、このファイルの内容を優先してください

---

## プロジェクト概要
- Discord Bot プロジェクト
- Python + discord.py（app_commands 使用）
- 機能単位は Cog で分割
- 実運用を前提とした安定性・保守性重視

---

## 行動ポリシー（重要）

### 許可なく実行してよいこと
以下は **ユーザー確認なしで実行してよい**：

- 既存コードの読み取り・構造把握
- バグ修正（例外処理・ロジック不備・型不整合）
- 小規模なリファクタリング（責務整理・可読性向上）
- 型ヒント・Docstring・ログ出力の追加
- 既存設計思想に沿った Cog / コマンドの追加
- テストコードの追加・修正・実行
- README / ドキュメントの更新（内容に沿ったもの）

---

### 事前確認が必須なこと
以下は **必ずユーザーに確認してから** 行ってください：

- 既存コマンド・設定・データ構造の削除
- 後方互換性を壊す変更
- 大規模なアーキテクチャ変更
- 新しい外部 API / 外部サービスの利用
- 権限管理・認証・セキュリティ仕様の変更
- requirements.txt への依存追加（理由提示必須）

---

## 実装ルール（強制）

### Cog / コマンド設計
- 機能は必ず Cog 単位で実装
- Cog 間の依存は最小限にする
- スラッシュコマンド（@app_commands.command）を使用
- 3秒を超える処理は defer() を使用

### 権限管理
- 権限チェックが必要なコマンドは必ず
  `permissions.can_run_command()` を使用
- 権限チェックを省略しないこと

### エラーハンドリング
- 非同期処理は必ず try-except で囲む
- エラーは logger.error(..., exc_info=True) で記録
- ユーザーには簡潔で分かりやすいエラーメッセージを返す
- interaction.response.send_message は原則 ephemeral=True

---

## コーディング規約
- 命名規則：
  - 変数・関数：snake_case
  - クラス：PascalCase
  - 定数：UPPER_SNAKE_CASE
- 可能な限り型ヒントを付与
- Docstring は Google Style
- print は使わず logging を使用

---

## 禁止事項（厳守）
- APIキー・トークンのハードコード
- 権限チェックの省略
- data/ 配下ファイルの無断削除
- .env ファイルの編集
- 意図の説明なしに依存パッケージを追加すること
- 「動けばOK」な場当たり的修正

---

## 作業後に必ず行うこと
変更を行った場合、以下を簡潔に報告してください：

- 変更内容
- 変更理由
- 影響範囲
- 追加で必要な作業（あれば）

---

## 不明点がある場合
- 勝手に仕様を補完しない
- 複数案がある場合は選択肢を提示する
- 「どこまで自動で進めてよいか」を確認する

## 補足
- 詳細な設計・実装パターンは src/INSTRUCTIONS.md を参照すること